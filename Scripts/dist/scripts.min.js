!function(){angular.module("casesApp",["ngRoute","ngAnimate","wc.directives","ui.bootstrap","breeze.angular"]).config(["$routeProvider",function(e){var t="/app/casesApp/views/";e.when("/cases",{controller:"CasesController",templateUrl:t+"cases/cases.html",controllerAs:"vm"}).when("/caseentries/:caseId",{controller:"CaseOrdersController",templateUrl:t+"cases/caseEntries.html",controllerAs:"vm"}).when("/caseedit/:caseId",{controller:"CaseEditController",templateUrl:t+"cases/caseEdit.html",controllerAs:"vm",secure:!0}).when("/entries",{controller:"OrdersController",templateUrl:t+"entries/entries.html",controllerAs:"vm"}).when("/about",{controller:"AboutController",templateUrl:t+"about.html",controllerAs:"vm"}).when("/login/:redirect*?",{controller:"LoginController",templateUrl:t+"login.html",controllerAs:"vm"}).otherwise({redirectTo:"/cases"})}]).run(["$rootScope","$location","authService",function(e,t,n){e.$on("$routeChangeStart",function(t,r,a){r&&r.$$route&&r.$$route.secure&&(n.user.isAuthenticated||e.$evalAsync(function(){n.redirectToLogin()}))})}])}(),function(){var e=function(){var e=.5;return{enter:function(t,n){var r=100*Math.random();TweenMax.set(t,{opacity:0,left:r+"px"});var a=Math.random();TweenMax.to(t,e,{opacity:1,left:"0px",ease:Back.easeInOut,delay:a,onComplete:n})},leave:function(t,n){TweenMax.to(t,e,{opacity:0,left:"-50px",onComplete:n})}}};angular.module("casesApp").animation(".card-animation",e)}(),function(){var e=[],t=function(){};t.$inject=e,angular.module("casesApp").controller("AboutController",t)}(),function(){var e=["$location","$routeParams","authService"],t=function(e,t,n){var r=this,a="/";r.email=null,r.password=null,r.errorMessage=null,r.login=function(){n.login(r.email,r.password).then(function(n){return n?(n&&t&&t.redirect&&(a+=t.redirect),void e.path(a)):void(r.errorMessage="Unable to login")})}};t.$inject=e,angular.module("casesApp").controller("LoginController",t)}(),function(){var e=["$scope","$location","config","authService"],t=function(e,t,n,r){function a(){var e="/login"+t.$$path;t.replace(),t.path(e)}function o(){i.loginLogoutText=r.user.isAuthenticated?"Logout":"Login"}var i=this,c="Case Manager";i.isCollapsed=!1,i.appTitle=n.useBreeze?c+" Breeze":c,i.highlight=function(e){return t.path().substr(0,e.length)===e},i.loginOrOut=function(){o();var e=r.user.isAuthenticated;e&&r.logout().then(function(){t.path("/")}),a()},e.$on("loginStatusChanged",function(e){o(e)}),e.$on("redirectToLogin",function(){a()}),o()};t.$inject=e,angular.module("casesApp").controller("NavbarController",t)}(),function(){var e=function(){return{restrict:"A",transclude:!0,scope:{name:"@"},link:function(e,t,n){t.bind("blur",function(n){e.$parent.$apply(function(){e.$parent[e.name]=t.val()})})}}};angular.module("casesApp").directive("lazyLoad",e)}(),function(){var e=["$q","dataService"],t=function(e,t){var n=function(n,r,a,o){o.$asyncValidators.unique=function(n,r){var o=e.defer(),i=n||r,c=a.wcUniqueKey,u=a.wcUniqueProperty;return c&&u?(t.checkUniqueValue(c,u,i).then(function(e){e?o.resolve():o.reject()}),o.promise):e.when(!0)}};return{restrict:"A",require:"ngModel",link:n}};t.$inject=e,angular.module("casesApp").directive("wcUnique",t)}(),function(){var e=function(){return function(e,t){if(!t)return e;var n=[];t=t.toLowerCase();for(var r=0;r<e.length;r++){var a=e[r];a["case"].toLowerCase().indexOf(t)>-1&&n.push(a)}return n}};angular.module("casesApp").filter("caseFilter",e)}(),function(){var e=function(){function e(e,t){if(e.entries)for(var n=0;n<e.entries.length;n++)if(e.entries[n].product.toLowerCase().indexOf(t)>-1)return!0;return!1}return function(t,n){if(!n||!t)return t;var r=[];n=n.toLowerCase();for(var a=0;a<t.length;a++){var o=t[a];(o.firstName.toLowerCase().indexOf(n)>-1||o.lastName.toLowerCase().indexOf(n)>-1||e(o,n))&&r.push(o)}return r}};angular.module("casesApp").filter("nameProductFilter",e)}(),function(){var e=["$http","$rootScope"],t=function(e,t){function n(e){a.user.isAuthenticated=e,t.$broadcast("loginStatusChanged",e)}var r="/api/dataservice/",a={loginPath:"/login",user:{isAuthenticated:!1,roles:null}};return a.login=function(t,a){return e.post(r+"login",{userLogin:{userName:t,password:a}}).then(function(e){var t=e.data.status;return n(t),t})},a.logout=function(){return e.post(r+"logout").then(function(e){var t=!e.data.status;return n(t),t})},a.redirectToLogin=function(){t.$broadcast("redirectToLogin",null)},a};t.$inject=e,angular.module("casesApp").factory("authService",t)}(),function(){var e=["breeze","$q","$window"],t=function(e,t,n){function r(e,t){function r(e,n,r){return t?e.results[0]:e.results}function a(e){n.alert(e.message)}return e.using(p).execute().then(r,a)}function a(e,t){var n=d.from(e);return t&&(n=n.expand(t)),r(n)}function o(){var e=p.metadataStore;return e.hasMetadataFor(f)?t.when(!0):e.fetchMetadata(f)}function i(e,t,r,a){var o=d.from(e).skip(r*a).take(a).inlineCount(!0);return t&&""!=t&&(o=o.expand(t)),o.using(p).execute().then(function(e){return{totalRecords:parseInt(e.inlineCount),results:e.results}},function(e){n.alert("Error "+e.message)})}function c(e){e.orderTotal=e.quantity*e.price}function u(e){e.entriesTotal=s(e)}function s(e){for(var t=0,n=e.entries,r=n.length,a=0;r>a;a++)t+=n[a].orderTotal;return t}var l={},d=e.EntityQuery;e.config.initializeAdapterInstance("modelLibrary","backingStore",!0),e.NamingConvention.camelCase.setAsDefault();var f="breeze/breezedataservice",p=new e.EntityManager(f);l.getCases=function(e,t){return i("Cases","entries",e,t)},l.getCasesSummary=function(e,t){return i("CasesSummary","",e,t)},l.getStates=function(){return a("States")},l.getCase=function(e){var t=d.from("Cases").where("id","==",e).expand("entries, state");return r(t,!0)},l.checkUniqueValue=function(t,n,r){var a=new e.Predicate(n,"==",r),o=t?a.and(new e.Predicate("id","!=",t)):a,i=d.from("Cases").where(o).take(0).inlineCount();return i.using(p).execute().then(function(e){return e&&0==e.inlineCount?!0:!1})},l.insertCase=function(e){return p.saveChanges()},l.newCase=function(){return o().then(function(){return p.createEntity("Case",{firstName:"",lastName:""})})},l.deleteCase=function(t){if(!t)return n.alert("ID was null - cannot delete"),null;var r=p.getEntityByKey("Case",t);if(r){var a=r.entries.slice();a.forEach(function(e){p.detachEntity(e)}),r.entityAspect.setDeleted()}else r=p.createEntity("Case",{id:t,gender:"Male"},e.EntityState.Deleted);return p.saveChanges()},l.updateCase=function(e){return p.saveChanges()};var h=function(){},g=function(){};return p.metadataStore.registerEntityTypeCtor("Order",h,c),p.metadataStore.registerEntityTypeCtor("Case",g,u),l};t.$inject=e,angular.module("casesApp").factory("casesBreezeService",t)}(),function(){var e=["$http","$q"],t=function(e,t){function n(e){for(var t=e.length,n=0;t>n;n++){var r=e[n];if(r.entries){for(var a=r.entries.length,i=0;a>i;i++){var c=r.entries[i];c.orderTotal=c.quantity*c.price}r.entriesTotal=o(r)}}}function r(t,r,o){var c=t;return c+=3==arguments.length?a(r,o):"",e.get(i+c).then(function(e){var t=e.data;return n(t),{totalRecords:parseInt(e.headers("X-InlineCount")),results:t}})}function a(e,t){var n="?$top="+t+"&$skip="+e*t;return n}function o(e){for(var t=0,n=e.entries,r=n.length,a=0;r>a;a++)t+=n[a].orderTotal;return t}var i="/api/dataservice/",c={};return c.getCases=function(e,t){return r("cases",e,t)},c.getCasesSummary=function(e,t){return r("casesSummary",e,t)},c.getStates=function(){return e.get(i+"states").then(function(e){return e.data})},c.checkUniqueValue=function(t,n,r){return t||(t=0),e.get(i+"checkUnique/"+t+"?property="+n+"&value="+escape(r)).then(function(e){return e.data.status})},c.insertCase=function(t){return e.post(i+"postCase",t).then(function(e){return t.id=e.data.id,e.data})},c.newCase=function(){return t.when({id:0})},c.updateCase=function(t){return e.put(i+"putCase/"+t.id,t).then(function(e){return e.data})},c.deleteCase=function(t){return e["delete"](i+"deleteCase/"+t).then(function(e){return e.data})},c.getCase=function(t){return e.get(i+"caseById/"+t).then(function(e){return n([e.data]),e.data})},c};t.$inject=e,angular.module("casesApp").factory("casesService",t)}(),function(){var e={useBreeze:!1};angular.module("casesApp").value("config",e)}(),function(){var e=["config","casesService","casesBreezeService"],t=function(e,t,n){return e.useBreeze?n:t};t.$inject=e,angular.module("casesApp").factory("dataService",t)}(),function(){angular.module("casesApp").config(["$httpProvider",function(e){var t=["$q","$rootScope"],n=function(e,t){var n=function(e){return e},r=function(n){return 401===n.status?(t.$broadcast("redirectToLogin",null),e.reject(n)):e.reject(n)};return function(e){return e.then(n,r)}};n.$inject=t,e.interceptors.push(n)}])}(),function(){var e=["$modal"],t=function(e){var t={backdrop:!0,keyboard:!0,modalFade:!0,templateUrl:"/app/casesApp/partials/modal.html"},n={closeButtonText:"Close",actionButtonText:"OK",headerText:"Proceed?",bodyText:"Perform this action?"};this.showModal=function(e,t){return e||(e={}),e.backdrop="static",this.show(e,t)},this.show=function(r,a){var o={},i={};return angular.extend(o,t,r),angular.extend(i,n,a),o.controller||(o.controller=function(e,t){e.modalOptions=i,e.modalOptions.ok=function(e){t.close("ok")},e.modalOptions.close=function(e){t.close("cancel")}},o.controller.$inject=["$scope","$modalInstance"]),e.open(o).result}};t.$inject=e,angular.module("casesApp").service("modalService",t)}(),function(){var e=function(){return{restrict:"A",transclude:!0,scope:{name:"@"},link:function(e,t,n){t.bind("blur",function(n){e.$parent.$apply(function(){e.$parent[e.name]=t.val()})})}}};angular.module("casesApp").directive("lazyLoad",e)}(),function(){var e=["$location"],t=function(e){var t=function(t,n){function r(){var r=e.path(),a=t.highlightClassName||"active";r&&angular.forEach(n.find("li"),function(e){var t=e.querySelector("a"),n=t&&t.href?t.href:t.getAttribute("data-href").replace("#",""),o=n.substr(n.indexOf("#/")+1,n.length),i=r.substr(0,o.length);o===i?angular.element(e).addClass(a):angular.element(e).removeClass(a)})}r(),t.$on("$locationChangeSuccess",r)};return{restrict:"A",scope:{highlightClassName:"@"},link:t}};t.$inject=e,angular.module("wc.directives").directive("menuHighlighter",t)}(),function(){var e=["$q","$timeout","$window","httpInterceptor"],t=function(e,t,n,r){var a='<div id="overlay-container" class="overlayContainer"><div id="overlay-background" class="overlayBackground"></div><div id="overlay-content" class="overlayContent" data-ng-transclude></div></div>',o=function(a,o,i){function c(){u(),n.jQuery&&s(),h=o[0].firstChild}function u(){r.request=function(t){return l(),t||e.when(t)},r.response=function(t){return d(),t||e.when(t)},r.responseError=function(t){return d(),e.reject(t)}}function s(){$(document).ajaxStart(function(){l()}),$(document).ajaxComplete(function(){d()}),$(document).ajaxError(function(){d()})}function l(){m.push({}),1==m.length&&(g=t(function(){m.length&&f()},a.wcOverlayDelay?a.wcOverlayDelay:500))}function d(){m.pop(),0==m.length&&(v=t(function(){0==m.length&&(p(),v&&t.cancel(v))},a.wcOverlayDelay?a.wcOverlayDelay:500))}function f(){var e=0,t=0;n.innerWidth?(e=n.innerWidth,t=n.innerHeight):0!=document.documentElement.clientWidth?(e=document.documentElement.clientWidth,t=document.documentElement.clientHeight):(e=document.body.clientWidth,t=document.body.clientHeight);var r=document.getElementById("overlay-content"),a=parseInt(C(r,"width").replace("px","")),o=parseInt(C(r,"height").replace("px",""));r.style.top=t/2-o/2+"px",r.style.left=e/2-a/2+"px",h.style.display="block"}function p(){g&&t.cancel(g),h.style.display="none"}var h=null,g=null,v=null,m=[];c();var C=function(){var e=null;return document.defaultView&&document.defaultView.getComputedStyle?e=document.defaultView.getComputedStyle:"undefined"!=typeof document.body.currentStyle&&(e=function(e,t){return e.currentStyle}),function(t,n){return e(t,null)[n]}}()};return{restrict:"EA",transclude:!0,scope:{wcOverlayDelay:"@"},template:a,link:o}},n=angular.module("wc.directives",[]);n.factory("httpInterceptor",function(){return{}}),n.config(["$httpProvider",function(e){e.interceptors.push("httpInterceptor")}]),t.$inject=e,n.directive("wcOverlay",t)}(),function(){var e=["$scope","$location","$routeParams","$timeout","config","dataService","modalService"],t=function(e,t,n,r,a,o,i){function c(){s().then(function(){v>0?o.getCase(v).then(function(e){g["case"]=e},d):o.newCase().then(function(e){g["case"]=e})}),h=e.$on("$locationChangeStart",u)}function u(e,n,r){if(g.editForm&&g.editForm.$dirty){var a={closeButtonText:"Cancel",actionButtonText:"Ignore Changes",headerText:"Unsaved Changes",bodyText:"You have unsaved changes. Leave the page?"};i.showModal({},a).then(function(e){"ok"===e&&(h(),t.path(t.url(n).hash()))}),e.preventDefault()}}function s(){return o.getStates().then(function(e){g.states=e},d)}function l(){e.editForm.$dirty=!1,g.updateStatus=!0,g.title="Edit",g.buttonText="Update",f()}function d(e){g.errorMessage=e.message,f()}function f(){p=r(function(){r.cancel(p),g.errorMessage="",g.updateStatus=!1},3e3)}var p,h,g=this,v=n.caseId?parseInt(n.caseId):0;g["case"]={},g.states=[],g.title=v>0?"Edit":"Add",g.buttonText=v>0?"Update":"Add",g.updateStatus=!1,g.errorMessage="",g.isStateSelected=function(e,t){return e===t},g.saveCase=function(){e.editForm.$valid&&(g["case"].id?o.updateCase(g["case"]).then(l,d):o.insertCase(g["case"]).then(l,d))},g.deleteCase=function(){var e=g["case"].firstName+" "+g["case"].lastName,n={closeButtonText:"Cancel",actionButtonText:"Delete Case",headerText:"Delete "+e+"?",bodyText:"Are you sure you want to delete this case?"};i.showModal({},n).then(function(e){"ok"===e&&o.deleteCase(g["case"].id).then(function(){h(),t.path("/cases")},d)})},c()};t.$inject=e,angular.module("casesApp").controller("CaseEditController",t)}(),function(){var e=["$scope","$routeParams","$window","dataService"],t=function(e,t,n,r){function a(){i>0&&r.getCase(i).then(function(t){o["case"]=t,e.$broadcast("case",t)},function(e){n.alert("Sorry, an error occurred: "+e.message)})}var o=this,i=t.caseId?parseInt(t.caseId):0;o["case"]={},o.entriesTotal=0,a()};t.$inject=e,angular.module("casesApp").controller("CaseOrdersController",t)}(),function(){var e=["$location","$filter","$window","$timeout","authService","dataService","modalService"],t=function(e,t,n,r,a,o,i){function c(){u()}function u(){o.getCasesSummary(d.currentPage-1,d.pageSize).then(function(e){d.totalRecords=e.totalRecords,d.cases=e.results,s(""),r(function(){d.cardAnimationClass=""},1e3)},function(e){n.alert("Sorry, an error occurred: "+e.data.message)})}function s(e){d.filteredCases=t("caseFilter")(d.cases,e),d.filteredCount=d.filteredCases.length}function l(e){for(var t=0;t<d.cases.length;t++){var n=d.cases[t];if(n.id===e)return n}return null}var d=this;d.cases=[],d.filteredCases=[],d.filteredCount=0,d.orderby="lastName",d.reverse=!1,d.searchText=null,d.cardAnimationClass=".card-animation",d.totalRecords=0,d.pageSize=10,d.currentPage=1,d.pageChanged=function(e){d.currentPage=e,u()},d.deleteCase=function(t){if(!a.user.isAuthenticated)return void e.path(a.loginPath+e.$$path);var r=l(t),c=r.firstName+" "+r.lastName,u={closeButtonText:"Cancel",actionButtonText:"Delete Case",headerText:"Delete "+c+"?",bodyText:"Are you sure you want to delete this case?"};i.showModal({},u).then(function(e){"ok"===e&&o.deleteCase(t).then(function(){for(var e=0;e<d.cases.length;e++)if(d.cases[e].id===t){d.cases.splice(e,1);break}s(d.searchText)},function(e){n.alert("Error deleting case: "+e.message)})})},d.DisplayModeEnum={Card:0,List:1},d.changeDisplayMode=function(e){switch(e){case d.DisplayModeEnum.Card:d.listDisplayModeEnabled=!1;break;case d.DisplayModeEnum.List:d.listDisplayModeEnabled=!0}},d.navigate=function(t){e.path(t)},d.setOrder=function(e){e===d.orderby&&(d.reverse=!d.reverse),d.orderby=e},d.searchTextChanged=function(){s(d.searchText)},c()};t.$inject=e,angular.module("casesApp").controller("CasesController",t)}(),function(){var e=["$filter","$window","dataService"],t=function(e,t,n){function r(){o()}function a(t){i.filteredCases=e("nameProductFilter")(i.cases,t),i.filteredCount=i.filteredCases.length}function o(){n.getCases(i.currentPage-1,i.pageSize).then(function(e){i.totalRecords=e.totalRecords,i.cases=e.results,a("")},function(e){t.alert(e.message)})}var i=this;i.cases=[],i.filteredCases,i.filteredCount,i.totalRecords=0,i.pageSize=10,i.currentPage=1,r(),i.pageChanged=function(e){i.currentPage=e,o()},i.searchTextChanged=function(){a(i.searchText)}};t.$inject=e,angular.module("casesApp").controller("OrdersController",t)}(),function(){var e=["$scope"],t=function(e){function t(){e["case"]?(r["case"]=e["case"],n(e["case"])):e.$on("case",function(e,t){r["case"]=t,n(t)})}function n(e){for(var t=0,n=0;n<e.entries.length;n++){var a=e.entries[n];t+=a.orderTotal}r.entriesTotal=t}var r=this;r.orderby="product",r.reverse=!1,r.entriesTotal=0,r["case"],t(),r.setOrder=function(e){e===r.orderby&&(r.reverse=!r.reverse),r.orderby=e}};t.$inject=e,angular.module("casesApp").controller("OrderChildController",t)}();